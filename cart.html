<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Your Cart — Rudhvi Vastraa</title>

  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Playfair+Display:wght@400;600;700&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" href="img-logo-removebg.png">

  <script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <style>
    /* Toast */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #E62727;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 15px;
      animation: fadeInOut 2.4s ease;
      z-index: 9999;
    }

    @keyframes fadeInOut {
      0% {
        opacity: 0;
        bottom: 0;
      }

      20% {
        opacity: 1;
        bottom: 20px;
      }

      80% {
        opacity: 1;
        bottom: 20px;
      }

      100% {
        opacity: 0;
        bottom: 0;
      }
    }

    /* PAYMENT CONTAINER */
    #paymentContainer {
      display: flex;
      justify-content: space-between;
      align-items: stretch;
      gap: 25px;
      margin-top: 25px;
      padding: 25px;
      background: #fafafa;
      border-radius: 14px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
    }

    .pay-left {
      width: 40%;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .pay-left h2 {
      margin: 0;
      font-size: 26px;
      font-weight: 700;
      color: #222;
    }

    .pay-right {
      width: 60%;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .pay-right-buttons {
      display: flex;
      justify-content: space-between;
      gap: 15px;
    }

    .payBtn {
      background: #E62727;
      color: white;
      width: 50%;
      padding: 14px;
      border-radius: 10px;
      border: none;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.25s ease;
      text-align: center;
    }

    .payBtn:hover {
      background: #c41f1f;
      transform: translateY(-2px);
    }

    .whatsappBtn {
      background: #25D366 !important;
    }

    .whatsappBtn:hover {
      background: #1ea756 !important;
    }

    #dynamicQRBox {
      width: 100%;
      text-align: center;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    #dynamicQRBox h3 {
      margin-bottom: 12px;
      font-size: 18px;
      font-weight: 600;
    }

    @media(max-width: 768px) {
      #paymentContainer {
        flex-direction: column;
      }

      .pay-left,
      .pay-right {
        width: 100%;
      }

      .pay-right-buttons {
        flex-direction: column;
      }

      .payBtn {
        width: 100%;
      }
    }
  </style>
</head>

<body>

  <!-- NAVBAR -->
  <div class="site-nav">
    <div class="inner">

      <img class="logo-img" src="text-logo.png" onclick="window.location.href='index.html'" />

      <div class="nav-icons">
        <input type="text" id="inlineSearch" class="inline-search-input" placeholder="Type to search...">

        <a href="javascript:void(0)" class="icon-btn" onclick="handleSearchClick()">
          <svg width="24" height="24" fill="none">
            <circle cx="11" cy="11" r="7.5" stroke="white" stroke-width="1.8"></circle>
            <line x1="16" y1="16" x2="21" y2="21" stroke="white" stroke-width="1.8"></line>
          </svg>
        </a>

        <a href="favorites.html" class="icon-btn">
          <svg width="24" height="24" fill="none" stroke="white" stroke-width="2">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 
                     2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 
                     14.76 3 16.5 3 19.58 3 22 5.42 22 8.5
                     c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
          </svg>
        </a>

        <a href="index.html" class="icon-btn">
          <svg width="24" height="24" stroke="white" stroke-width="2" fill="none">
            <path d="M3 10.5 12 3l9 7.5V20a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V10.5Z" />
            <path d="M9 21V14h6v7" />
          </svg>
        </a>

        <a href="profile.html" class="icon-btn">
          <svg width="24" height="24" fill="none" stroke="#fff" stroke-width="2">
            <circle cx="12" cy="7" r="4" />
            <path d="M4 21c0-4 4-7 8-7s8 3 8 7" />
          </svg>
        </a>

      </div>
    </div>
  </div>

  <!-- CART -->
  <main>
    <h1>Your Cart</h1>

    <div id="cartList"></div>

    <div id="cartFooter" class="cart-footer-area">
      <div id="paymentContainer">

        <div class="pay-left">
          <div id="totalPrice"></div>
        </div>

        <div class="pay-right">

          <div class="pay-right-buttons">
            <button class="payBtn" onclick="payViaUPI()">Pay via UPI</button>
            <button class="payBtn whatsappBtn" onclick="payViaWhatsApp()">Order via WhatsApp</button>
          </div>

          <div id="dynamicQRBox">
            <h3>Scan to Pay</h3>
            <canvas id="upiQR"></canvas>
          </div>

        </div>

      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer>© <span id="year"></span> Rudhvi Vastraa — All rights reserved</footer>

  <script>

    document.getElementById("year").textContent = new Date().getFullYear();

    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    function renderCart() {
      const list = document.getElementById("cartList");
      const totalEl = document.getElementById("totalPrice");

      if (cart.length === 0) {
        list.innerHTML = `<p style="text-align:center;padding:40px 0;color:#777;">Your cart is empty.</p>`;
        document.getElementById("cartFooter").style.display = "none";
        return;
      }

      document.getElementById("cartFooter").style.display = "block";

      list.innerHTML = cart.map((item, i) => `
  <div class="tile">

    <div class="img-wrapper" onclick="goToDetails('${item.id}')">
      <img src="${item.image}">
    </div>

    <div class="tile-content" onclick="goToDetails('${item.id}')">
      <h3>${item.name}</h3>
      <p>ID: ${item.id}</p>
      <p><strong>₹${item.price}</strong></p>
    </div>

    <div class="tile-actions">
      <button class="qty-btn" onclick="changeQty(${i}, -1)">−</button>
      <span>${item.qty}</span>
      <button class="qty-btn" onclick="changeQty(${i}, 1)">+</button>
    </div>

  </div>
`).join("");

      const total = cart.reduce((sum, x) => sum + x.qty * x.price, 0);
      totalEl.innerHTML = `<h2>Total: ₹${total.toLocaleString()}</h2>`;

      generateQR();
    }

    function changeQty(i, delta) {
      cart[i].qty += delta;
      if (cart[i].qty <= 0) cart.splice(i, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    }

    function generateQR() {
      const total = cart.reduce((s, i) => s + i.qty * i.price, 0);
      if (total <= 0) return;

      const upiID = "siddu944015-2@okaxis";
      const upiName = "Rudhvi Vastraa";
      const orderLabel = cart.map(i => `${i.id}*${i.qty}`).join("-");

      const upiLink =
        `upi://pay?pa=${upiID}&pn=${encodeURIComponent(upiName)}&am=${total}&cu=INR&tn=${encodeURIComponent(orderLabel)}`;

      new QRious({
        element: document.getElementById("upiQR"),
        value: upiLink,
        size: 200
      });
    }

    /* -------------------------
       PAYMENT VIA RAZORPAY
    ------------------------- */

    function payViaUPI() {

      const total = cart.reduce((s, i) => s + i.qty * i.price, 0);
      const customerName = localStorage.getItem("userName") || "Customer";

      var options = {
        "key": "rzp_live_Rm0jM0TPWo554c",
        "amount": total * 100,
        "currency": "INR",
        "name": "Rudhvi Vastraa",
        "description": "Order Payment",
        "image": "text-logo.png",

        "handler": async function (response) {

          const customerName = localStorage.getItem("userName") || "Customer";
          const customerPhone = localStorage.getItem("phone") || "";
          const ownerPhone = "+918106662341";

          const orderDetails = cart.map(i =>
            `${i.name} × ${i.qty} — ₹${i.qty * i.price}`
          ).join("\n");

          const total = cart.reduce((s, i) => s + i.qty * i.price, 0);

          const smsMessage =
            `New Order Received\n\n` +
            `Name: ${customerName}\n` +
            `Phone: ${customerPhone}\n\n` +
            `Items:\n${orderDetails}\n\n` +
            `Total: ₹${total}\n` +
            `Payment ID: ${response.razorpay_payment_id}`;

          // Send SMS using Cloudflare Worker
          await fetch("https://rudhvi-vastraa.adityathirumala20.workers.dev/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              to: ownerPhone,
              message: smsMessage
            })
          });

          alert("Order SMS sent to owner!");
        },

        "prefill": {
          "name": customerName,
          "email": localStorage.getItem("email") || "customer@example.com",
          "contact": localStorage.getItem("phone") || "9999999999"
        },

        "theme": {
          "color": "#E62727"
        }
      };

      var rzp1 = new Razorpay(options);
      rzp1.open();
    }

    function payViaWhatsApp() {
      const name = localStorage.getItem("userName") || "Customer";
      let msg = `Hello,%0AI am ${name}.%0AOrder Details:%0A`;

      cart.forEach(i => msg += `${i.name} × ${i.qty} — ₹${i.qty * i.price}%0A`);

      const total = cart.reduce((s, i) => s + i.qty * i.price, 0);
      msg += `%0ATotal: ₹${total}`;

      window.open(`https://wa.me/918106662341?text=${msg}`, "_blank");
    }

    renderCart();

    function goToDetails(id) {
      window.location.href = `product-details.html?id=${id}`;
    }

    function handleSearchClick() {
      const searchInput = document.getElementById("inlineSearch");
      if (searchInput.classList.contains("active")) {
        const query = searchInput.value.trim();
        if (query.length > 0) {
          window.location.href = `search.html?q=${encodeURIComponent(query)}`;
        } else {
          searchInput.classList.remove("active");
        }
      } else {
        searchInput.classList.add("active");
        searchInput.focus();
      }
    }

    document.getElementById("inlineSearch").addEventListener("keypress", function (event) {
      if (event.key === "Enter") {
        const query = this.value.trim();
        if (query.length > 0) {
          window.location.href = `search.html?q=${encodeURIComponent(query)}`;
        }
      }
    });

  </script>

</body>
</html>
