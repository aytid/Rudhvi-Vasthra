<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Your Cart — Rudhvi Vastraa</title>

  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Playfair+Display:wght@400;600;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" sizes="256x256" href="img-logo-removebg.png">

  <script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>
</head>

<body>

  <!-- NAVBAR -->
  <div class="site-nav">
    <div class="inner">
      <img class="logo-img" src="text-logo.png" onclick="window.location.href='index.html'" alt="Rudhvi Vastraa Logo" />

      <div class="nav-icons">
        <input type="text" id="inlineSearch" class="inline-search-input" placeholder="Type to search...">
        <a href="javascript:void(0)" class="icon-btn" onclick="handleSearchClick()">
          <svg width="24" height="24" fill="none">
            <circle cx="11" cy="11" r="7.5" stroke="white" stroke-width="1.8"></circle>
            <line x1="16" y1="16" x2="21" y2="21" stroke="white" stroke-width="1.8"></line>
          </svg>
        </a>
        <a href="favorites.html" class="icon-btn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path
              d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
              stroke="#FFFFFF" stroke-width="2" />
          </svg>
        </a>
        <a href="index.html" class="icon-btn cart-btn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M3 10.5L12 3L21 10.5V20C21 20.6 20.6 21 20 21H4C3.4 21 3 20.6 3 20V10.5Z" stroke="white"
              stroke-width="1.8" />
            <path d="M9 21V14H15V21" stroke="white" stroke-width="1.8" />
          </svg>
        </a>

        <a href="profile.html" class="icon-btn" aria-label="Profile">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none"xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="7" r="4" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M4 21c0-4 4-7 8-7s8 3 8 7" 
          stroke="#FFFFFF" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
        
      </div>
    </div>
  </div>


  <main>
    <h1>Your Cart</h1>

    <div id="cartList"></div>

    <div class="cart-footer-area" id="cartFooter">
      <div class="footer-left-content">
        <div id="totalPrice"></div>
        <button id="proceedBtn" class="payBtn">Proceed to Payment</button>
      </div>

      <div id="dynamicQRBox">
        <h3>Scan to Pay</h3>
        <canvas id="upiQR"></canvas>
      </div>
    </div>
  </main>

  <!-- CONTACT SECTION -->
  <section class="contact">
    <div style="max-width:1000px;margin:auto;">
      <h2>Get in Touch</h2>
      <p>For product enquiries or assistance, reach out to us below.</p>
      <div class="contact-links">

        <a href="https://wa.me/918106662341" target="_blank" class="contact-pill">
          WhatsApp: +91 8106662341
        </a>

        <a href="https://instagram.com/rudhvi_vastraa" target="_blank" class="contact-pill">@rudhvi_vastraa</a>
        <a href="https://youtube.com/@rudhvivastraa" target="_blank" class="contact-pill">YouTube</a>

      </div>
    </div>
  </section>

  <footer>
    © <span id="year"></span> Rudhvi Vastraa — All rights reserved
  </footer>

  <!-- PAYMENT POPUP -->
  <div id="paymentPopup">
    <div id="popupBox">
      <h2>Payment Options</h2>
      <button class="popupBtn" onclick="payViaUPI()">Pay via UPI App</button>
      <button class="popupBtn" onclick="payViaWhatsApp()">Order via WhatsApp</button>
      <button class="popupBtn closeBtn" onclick="closePopup()">Cancel</button>
    </div>
  </div>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    /* CART DATA */
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    /* RENDER CART */
    function renderCart() {
      const list = document.getElementById("cartList");
      const totalEl = document.getElementById("totalPrice");
      const footerEl = document.getElementById("cartFooter");

      if (cart.length === 0) {
        list.innerHTML = `<p style="text-align:center;padding:40px;">Your cart is empty.</p>`;
        footerEl.style.display = "none";
        return;
      }

      footerEl.style.display = "block";

      list.innerHTML = cart.map((item, i) => `
        <div class="tile">
          <div class="img-wrapper">
            <img src="${item.image}" alt="${item.name}">
          </div>

          <div class="tile-content">
            <h3>${item.name}</h3>
            <p>ID: ${item.id}</p>
            <p><strong>₹${item.price}</strong></p>
          </div>

          <div class="tile-actions">
            <button class="qty-btn" onclick="changeQty(${i}, -1)">−</button>
            <span>${item.qty}</span>
            <button class="qty-btn" onclick="changeQty(${i}, 1)">+</button>
          </div>
        </div>
      `).join("");

      const total = cart.reduce((sum, i) => sum + i.qty * i.price, 0);

      totalEl.innerHTML = `<h3>Total: ₹${total.toLocaleString()}</h3>`;

      generateDynamicQR();
    }

    /* CHANGE QTY */
    function changeQty(i, delta) {
      cart[i].qty += delta;
      if (cart[i].qty <= 0) cart.splice(i, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    }

    /* QR GENERATION */
    function generateDynamicQR() {
      const total = cart.reduce((sum, item) => sum + item.price * item.qty, 0);
      const qrBox = document.getElementById("dynamicQRBox");

      if (total <= 0) {
        qrBox.style.display = "none";
        return;
      }

      qrBox.style.display = "block";

      const upiID = "siddu944015-2@okaxis";
      const upiName = "Rudhvi Vastraa";
      const label = cart.map(i => `${i.id}*${i.qty}`).join("-");
      const upiLink =
        `upi://pay?pa=${encodeURIComponent(upiID)}` +
        `&pn=${encodeURIComponent(upiName)}` +
        `&am=${total}` +
        `&cu=INR` +
        `&tn=${encodeURIComponent(label)}`;

      new QRious({
        element: document.getElementById("upiQR"),
        value: upiLink,
        size: 200
      });
    }

    /* POPUP CONTROL */
    const proceedBtn = document.getElementById("proceedBtn");
    if (proceedBtn) proceedBtn.onclick = () => {
      document.getElementById("paymentPopup").style.display = "flex";
    };

    function closePopup() {
      document.getElementById("paymentPopup").style.display = "none";
    }

    /* PAY VIA UPI APP */
    function payViaUPI() {
      const total = cart.reduce((s, i) => s + i.price * i.qty, 0);

      const upiID = "siddu944015-2@okaxis";
      const upiName = "Rudhvi Vastraa";
      const label = cart.map(i => `${i.id}*${i.qty}`).join("-");
      const ref = "TXN" + Date.now();

      const link =
        `upi://pay?pa=${upiID}` +
        `&pn=${encodeURIComponent(upiName)}` +
        `&am=${total}` +
        `&cu=INR` +
        `&tr=${ref}` +
        `&tn=${encodeURIComponent(label)}`;

      window.location.href = link;

      // Auto WhatsApp message
      setTimeout(() => {
        sendWhatsAppMessage(total, label);
      }, 2000);
    }

    /* SEND WHATSAPP CONFIRMATION */
    function sendWhatsAppMessage(total, label) {
      const name = localStorage.getItem("userName") || "Customer";

      let msg = `Hello Rudhvi Vastraa,%0A` +
        `I have completed the UPI payment.%0A` +
        `Name: ${name}%0A` +
        `Order Items: ${label}%0A` +
        `Total Paid: ₹${total}%0A`;

      window.open(`https://wa.me/918106662341?text=${msg}`, "_blank");
    }

    /* ALTERNATE WHATSAPP ORDER */
    function payViaWhatsApp() {
      const name = localStorage.getItem("userName") || "Customer";
      let msg = `Hello Rudhvi Vastraa,%0AI'm ${name}%0AI want to order:%0A`;

      cart.forEach(i => {
        msg += `${i.name} (ID:${i.id}) x${i.qty} — ₹${i.price * i.qty}%0A`;
      });

      const total = cart.reduce((s, i) => s + i.qty * i.price, 0);
      msg += `%0ATotal: ₹${total}`;

      window.open(`https://wa.me/918106662341?text=${msg}`, "_blank");
    }

    renderCart();
  </script>

</body>
</html>
