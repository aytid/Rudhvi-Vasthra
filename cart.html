<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Your Cart â€” Rudhvi Vastraa</title>

  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Playfair+Display:wght@400;600;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" sizes="256x256" href="img-logo-removebg.png">

  <script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>
</head>

<body>

  <div class="site-nav">
    <div class="inner">
      <div class="hamburger" onclick="toggleMobileMenu()">â˜°</div>
      <div class="nav-contact">
        <div class="desktop-dropdown">
          <div class="desktop-dropdown-header" onclick="toggleDesktopMenu()">
            Shop By <span class="desk-arrow">âŒ„</span>
          </div>
          <div id="desktopMenu" class="desktop-menu">
            <div class="desk-group">
              <div class="desk-group-header" onclick="toggleDeskGroup('desk-type')">
                Type <span class="desk-arrow-small">âŒ„</span>
              </div>
              <div class="desk-group-body" id="desk-type">
                <a href="#">Banaras</a>
                <a href="#">Kanjivaram</a>
                <a href="#">Printed</a>
                <a href="#">Handloom</a>
                <a href="#">Exclusive</a>
                <a href="#">All Sarees</a>
              </div>
            </div>
            <div class="desk-group">
              <div class="desk-group-header" onclick="toggleDeskGroup('desk-occ')">
                Occasion <span class="desk-arrow-small">âŒ„</span>
              </div>
              <div class="desk-group-body" id="desk-occ">
                <a href="#">Wedding Wear</a>
                <a href="#">Party Wear</a>
                <a href="#">Festive Wear</a>
                <a href="#">Reception Wear</a>
                <a href="#">Casual Wear</a>
              </div>
            </div>
            <div class="desk-group">
              <div class="desk-group-header" onclick="toggleDeskGroup('desk-range')">
                Range <span class="desk-arrow-small">âŒ„</span>
              </div>
              <div class="desk-group-body" id="desk-range">
                <a href="#">Under 10k</a>
                <a href="#">Under 20k</a>
                <a href="#">Under 30k</a>
                <a href="#">Under 40k</a>
                <a href="#">Above 40k</a>
              </div>
            </div>
          </div>
        </div>
        <a href="#">Contact Us</a>
      </div>

      <img class="logo-img" src="text-logo.png" onclick="window.location.href='index.html'" alt="Rudhvi Vastraa Logo" />

      <div class="nav-icons">
        <input type="text" id="inlineSearch" class="inline-search-input" placeholder="Type to search...">
        <a href="javascript:void(0)" class="icon-btn" onclick="handleSearchClick()">
          <svg width="24" height="24" fill="none">
            <circle cx="11" cy="11" r="7.5" stroke="white" stroke-width="1.8"></circle>
            <line x1="16" y1="16" x2="21" y2="21" stroke="white" stroke-width="1.8"></line>
          </svg>
        </a>
        <a href="favorites.html" class="icon-btn">
          <svg width="24" height="24" fill="none">
            <path d="M12 20s-7-4.5-7-10a5 5 0 0 1 9-3 5 5 0 0 1 9 3c0 5.5-7 10-7 10z" stroke="white" stroke-width="1.8"
              stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </a>
        <a href="index.html" class="icon-btn cart-btn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M3 10.5L12 3L21 10.5V20C21 20.6 20.6 21 20 21H4C3.4 21 3 20.6 3 20V10.5Z" stroke="white"
              stroke-width="1.8" stroke-linejoin="round" />
            <path d="M9 21V14H15V21" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          <span id="cartCount" style="display:none"></span> 
        </a>
      </div>
    </div>

    <div class="mobile-menu" id="mobileMenu">
      <div class="mobile-dropdown">
        <div class="mobile-dropdown-header" onclick="toggleDrop('drop-type')">
          Type <span class="arrow">âŒ„</span>
        </div>
        <div id="drop-type" class="mobile-dropdown-body">
          <a href="#">Banaras</a>
          <a href="#">Kanjivaram</a>
          <a href="#">Printed</a>
          <a href="#">Handloom</a>
          <a href="#">Exclusive</a>
          <a href="#">All Sarees</a>
        </div>
      </div>
      <div class="mobile-dropdown">
        <div class="mobile-dropdown-header" onclick="toggleDrop('drop-occ')">
          Occasion <span class="arrow">âŒ„</span>
        </div>
        <div id="drop-occ" class="mobile-dropdown-body">
          <a href="#">Wedding Wear</a>
          <a href="#">Party Wear</a>
          <a href="#">Festive Wear</a>
          <a href="#">Reception Wear</a>
          <a href="#">Casual Wear</a>
        </div>
      </div>
      <div class="mobile-dropdown">
        <div class="mobile-dropdown-header" onclick="toggleDrop('drop-range')">
          Range <span class="arrow">âŒ„</span>
        </div>
        <div id="drop-range" class="mobile-dropdown-body">
          <a href="#">Under 10k</a>
          <a href="#">Under 20k</a>
          <a href="#">Under 30k</a>
          <a href="#">Under 40k</a>
          <a href="#">Above 40k</a>
        </div>
      </div>
      <a href="#" class="mobile-contact">Contact Us</a>
    </div>
  </div>

<main>
  <h1>Your Cart</h1>

  <div id="cartList"></div>

  <div class="cart-footer-area" id="cartFooter">
    
    <div class="footer-left-content">
      <div id="totalPrice"></div>
      <button id="proceedBtn" class="payBtn">Proceed to Payment</button>
    </div>

    <div id="dynamicQRBox">
      <h3>Scan to Pay</h3>
      <canvas id="upiQR"></canvas>
    </div>

  </div>
</main>

  <section class="contact">
     <div style="max-width:1000px;margin:auto;">
      <h2>Get in Touch</h2>
      <p>For product enquiries, collaborations, or assistance, reach out to us below.</p>
      <div class="contact-links">
        <a href="https://wa.me/918106662341" target="_blank" class="contact-pill">WhatsApp</a>
        <a href="https://instagram.com/rudhvi_vastraa" target="_blank" class="contact-pill">Instagram</a>
        <a href="https://youtube.com/@rudhvivastraa?si=qEKagU95Scu20b3B" target="_blank" class="contact-pill">YouTube</a>
      </div>
    </div>
  </section>

  <footer>
    Â© <span id="year"></span> Rudhvi Vastraa â€” All rights reserved
  </footer>

  <div id="paymentPopup">
    <div id="popupBox">
      <h2>Choose Payment Method</h2>
      <button class="popupBtn" onclick="payViaUPI()">Pay via UPI</button>
      <button class="popupBtn" onclick="payViaWhatsApp()">Order via WhatsApp</button>
      <button class="popupBtn closeBtn" onclick="closePopup()">Cancel</button>
    </div>
  </div>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    /* --- NAVBAR JS --- */
    function toggleMobileMenu() {
      const menu = document.getElementById("mobileMenu");
      menu.style.display = menu.style.display === "block" ? "none" : "block";
    }

    function toggleDrop(id) {
      const body = document.getElementById(id);
      const arrow = body.previousElementSibling.querySelector(".arrow");
      if (body.style.display === "block") {
        body.style.display = "none";
        arrow.style.transform = "rotate(0deg)";
      } else {
        body.style.display = "block";
        arrow.style.transform = "rotate(180deg)";
      }
    }

    function toggleDesktopMenu() {
      const menu = document.getElementById("desktopMenu");
      const arrow = document.querySelector(".desk-arrow");
      if (menu.style.display === "block") {
        menu.style.display = "none";
        arrow.style.transform = "rotate(0deg)";
      } else {
        menu.style.display = "block";
        arrow.style.transform = "rotate(180deg)";
      }
    }

    // Close dropdown when clicking outside
    document.addEventListener("click", (e) => {
      const menu = document.getElementById("desktopMenu");
      const header = document.querySelector(".desktop-dropdown-header");
      if (header && menu && !header.contains(e.target) && !menu.contains(e.target)) {
        menu.style.display = "none";
        if(document.querySelector(".desk-arrow")) 
             document.querySelector(".desk-arrow").style.transform = "rotate(0deg)";
      }
    });

    function toggleDeskGroup(id) {
      const body = document.getElementById(id);
      const arrow = body.previousElementSibling.querySelector(".desk-arrow-small");
      if (body.style.display === "block") {
        body.style.display = "none";
        arrow.style.transform = "rotate(0deg)";
      } else {
        body.style.display = "block";
        arrow.style.transform = "rotate(180deg)";
      }
    }

    /* --- SEARCH JS --- */
    function handleSearchClick() {
      const searchInput = document.getElementById("inlineSearch");
      if (searchInput.classList.contains("active")) {
        const query = searchInput.value.trim();
        if (query.length > 0) {
          window.location.href = `search.html?q=${encodeURIComponent(query)}`;
        } else {
          searchInput.classList.remove("active");
        }
      } else {
        searchInput.classList.add("active");
        searchInput.focus();
      }
    }
    document.getElementById("inlineSearch").addEventListener("keypress", function (e) {
      if (e.key === "Enter") {
        const query = this.value.trim();
        if (query.length > 0) window.location.href = `search.html?q=${encodeURIComponent(query)}`;
      }
    });

    /* --- QR CODE GENERATION FUNCTION --- */
    /* Moved here so it is defined before renderCart calls it */
    function generateDynamicQR() {
      const total = cart.reduce((sum, item) => sum + item.price * item.qty, 0);
      const qrBox = document.getElementById("dynamicQRBox");

      // If cart is empty or total is 0, hide QR
      if (total <= 0) {
        qrBox.style.display = "none";
        return;
      }

      qrBox.style.display = "block";
      const canvas = document.getElementById("upiQR");

      // UPI Info
      const upiID = "adityathirumala20@oksbi";
      const upiName = "Rudhvi Vastraa";
      
      // Construct UPI Link
      const upiLink =
        `upi://pay?pa=${encodeURIComponent(upiID)}` +
        `&pn=${encodeURIComponent(upiName)}` +
        `&am=${total}` +
        `&cu=INR`;

      // Generate QR
      // Note: Since we imported QRious in the <head>, it is available here.
      new QRious({
        element: canvas,
        value: upiLink,
        size: 200,
        level: "H"
      });

      console.log("QR UPDATED for amount:", total);
    }

    /* --- CART JS --- */
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    function renderCart() {
      const list = document.getElementById("cartList");
      const totalEl = document.getElementById("totalPrice");
      const footerEl = document.getElementById("cartFooter");
      const cartCountEl = document.getElementById("cartCount"); // Fix: get the element

      if (cart.length === 0) {
        list.innerHTML = `<p style="grid-column:1/-1; text-align:center; font-size:18px; padding:40px;">Your cart is empty.</p>`;
        footerEl.style.display = "none";
        if(cartCountEl) cartCountEl.textContent = 0; // Check if exists
        
        // Hide QR when cart is empty
        document.getElementById("dynamicQRBox").style.display = "none";
        return;
      }

      footerEl.style.display = "block";

      list.innerHTML = cart.map((item, i) => `
        <div class="tile">
          <div style="cursor:pointer;" onclick="window.location.href='product-details.html?id=${item.id}'">
            <div class="img-wrapper">
              <img src="${item.image}" alt="${item.name}">
            </div>
          </div>

          <div class="tile-content" onclick="window.location.href='product-details.html?id=${item.id}'" style="cursor:pointer;">
            <h3>${item.name}</h3>
            <div class="saree-id">ID: ${item.id}</div>
            <p class="price"><strong>â‚¹${item.price}</strong></p>
          </div>

          <div class="tile-actions">
            <button class="qty-btn" onclick="changeQty(${i}, -1)">âˆ’</button>
            <span class="qty-val">${item.qty}</span>
            <button class="qty-btn" onclick="changeQty(${i}, 1)">+</button>
          </div>
        </div>
      `).join("");

      const total = cart.reduce((sum, x) => sum + x.price * x.qty, 0);
      totalEl.innerHTML = `<h3>Total: â‚¹${total.toLocaleString()}</h3>`;

      if(cartCountEl) cartCountEl.textContent = cart.reduce((sum, x) => sum + x.qty, 0);

      /* ðŸ”¥ CALLS THE QR FUNCTION - NOW IT WILL WORK */
      generateDynamicQR();
    }

    function changeQty(i, delta) {
      cart[i].qty += delta;
      if (cart[i].qty <= 0) cart.splice(i, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    }

    /* --- PAYMENT POPUP JS --- */
    const proceedBtn = document.getElementById("proceedBtn");
    if(proceedBtn) {
        proceedBtn.onclick = () => {
          document.getElementById("paymentPopup").style.display = "flex";
        };
    }

    function closePopup() {
      document.getElementById("paymentPopup").style.display = "none";
    }

function payViaUPI() {
  
      const total = cart.reduce((s, i) => s + i.price * i.qty, 0);
      
      if (!total || total <= 0) {
        alert("Cart is empty or invalid!");
        return;
      }

      const formattedTotal = total.toFixed(2);

      const uniqueRef = "TXN" + Date.now(); 

      const upiID = "adityathirumala20@oksbi";
      const upiName = "Rudhvi Vastraa";
      const note = "Payment for Order";
      const link = 
        "upi://pay?" +
        "pa=" + encodeURIComponent(upiID) +       // Payee Address
        "&pn=" + encodeURIComponent(upiName) +    // Payee Name
        "&am=" + formattedTotal +                 // Amount
        "&cu=INR" +                               // Currency
        "&tr=" + uniqueRef +                      // UNIQUE Transaction Ref
        "&tn=" + encodeURIComponent(note);        // Transaction Note

      // 5. Redirect
      window.location.href = link;
    }

    function payViaWhatsApp() {
      const name = localStorage.getItem("userName") || "Customer";
      let msg = `Hello Rudhvi Vastraa,%0AI'm ${name}%0AOrder:%0A`;
      cart.forEach(i => {
        msg += `${i.name} (ID:${i.id}) x${i.qty} â€” â‚¹${i.qty * i.price}%0A`;
      });
      const total = cart.reduce((s, i) => s + i.qty * i.price, 0);
      msg += `%0ATotal: â‚¹${total}`;
      window.open(`https://wa.me/918106662341?text=${msg}`, "_blank"); // Fixed wa.me link format
    }

    // Initial Render
    renderCart();
  </script>

</body>
</html>
